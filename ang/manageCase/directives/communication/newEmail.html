<div class="com__send-new-email-wrap">

    <button ng-if="!isShowSendEmailWindow" class="com__send-new-email-button spc__button spc--height-medium" ng-click="toggleSendEmailWindow()">
        <span class="ui-button-icon ui-icon fa-send"></span>
        <span class="ui-button-icon-space"> </span>
        <span>Send New Email</span>
    </button>

    <div ng-if="isShowSendEmailWindow">
        <ng-form name="sendNewEmailForm">
            <div class="com__email-block">
                <div class="com__email-top-block">
                    <div class="com__email-info-rows-wrap">
                        <div class="com__email-info-rows-title">Send new email</div>
                        <div class="com__email-info-row">
                            <div class="com__email-info-row-name">From:</div>
                            <div class="com__email-info-row-value">
                                <div>
                                    <select-email case-id="model.case_id" is-required="true" is-multiple="false" max-width="600" model="emailData.from_email_id"></select-email>
                                </div>
                            </div>
                        </div>
                        <div class="com__email-info-row">
                            <div class="com__email-info-row-name">To:</div>
                            <div class="com__email-info-row-value">
                                <div>
                                    <select-email case-id="model.case_id" is-required="true" is-multiple="true" max-width="600" model="emailData.to_email_id"></select-email>
                                </div>
                            </div>
                        </div>
                        <div class="com__email-info-row">
                            <div class="com__email-info-row-name">CC:</div>
                            <div class="com__email-info-row-value">
                                <div>
                                    <select-email case-id="model.case_id" is-required="false" is-multiple="true" max-width="600" model="emailData.cc_email_ids"></select-email>
                                </div>
                            </div>
                        </div>
                        <div class="com__email-info-row">
                            <div class="com__email-info-row-name">Subject:</div>
                            <div class="com__email-info-row-value">
                                <div class="com__edit-subject-input-wrap">
                                    <input name="subject" class="spc__input spc--width-100-percent" ng-model="emailData.subject" type="text" ng-required="true">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="com__email-bottom-block">
                    <!-- 'crm-ui-richtext' directive works only in table -->
                    <div>
                        <table class="crm-entity spc__table spc--no-border crm-search-results">
                            <tbody>
                            <tr class="com__reply spc--no-border" >
                                <td crm-ui-id-scope colspan="3" class="spc--padding-0">
                                    <div>
                                        <div class="com__reply-edit-area">
                                            <div class="com__templates">
                                                <input class="spc__input spc--single-select"
                                                       support-case-category-id="{{emailData['case_category_id']}}"
                                                       token-contact-id="{{emailData['token_contact_id']}}"
                                                       mailutils-template on-select="$broadcast('insert:reply', token.name)"
                                                       tabindex="-1" style="z-index:1">
                                            </div>
                                            <textarea crm-ui-id="email-reply-email-body" crm-ui-richtext crm-ui-insert-rx="insert:reply" editor-focus-on-load
                                                      name="emailBody" ng-model="emailData.body"
                                                      style="height: 500px" data-preset="supportcase"></textarea>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <spc-attachment-uploader model="emailData.attachments" ></spc-attachment-uploader>

                    <div class="com__errors-wrap"></div>

                    <div class="com__message-buttons">
                        <div class="com__message-buttons-loader" ng-if="isEmailSending">
                            Email is sending... Please wait.
                        </div>
                        <button ng-if="!isEmailSending" class="spc__button spc--height-medium" ng-disabled="sendNewEmailForm.$invalid" ng-click="send()">
                            <span class="ui-button-icon ui-icon fa-paper-plane-o"></span>
                            <span class="ui-button-icon-space"> </span>
                            <span>Send</span>
                        </button>
                        <button ng-if="!isEmailSending" class="spc__button spc--height-medium button__cancel" ng-click="toggleSendEmailWindow()">Cancel</button>
                    </div>

                </div>
            </div>
        </ng-form>
    </div>
</div>
